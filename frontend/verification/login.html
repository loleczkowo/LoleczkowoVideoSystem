<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login â€“ Loleczkowo Video System</title>

    <!-- Shared stylesheet -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <h2>Login</h2>

    <form id="loginForm">
        <input type="text"  name="identifier" placeholder="Gmail or Nickname" required>

        <div class="password-field">
            <input type="password" name="password" id="loginPassword" placeholder="Password" required>
            <span class="toggle-password" onclick="togglePassword('loginPassword',this)">Show</span>
        </div>

        <button type="submit">Log in</button>
        <p class="error"   id="loginError"></p>
    </form>

    <div class="link">
        <p>Need an account? <a href="signup.html">Sign up</a></p>
    </div>
</div>

<script>
function togglePassword(inputId, toggleEl){
    const input=document.getElementById(inputId);
    if(input.type==='password'){
        input.type='text';
        toggleEl.textContent='Hide';
    }else{
        input.type='password';
        toggleEl.textContent='Show';
    }
}

loginForm.addEventListener('submit', async e => {
    e.preventDefault();
    loginError.textContent = '';
    try {
        const r   = await fetch('/api/login', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
                identifier: loginForm.identifier.value.trim(),
                password:   loginPassword.value
            })
        });
        const obj = await r.json();

        if (obj.result === 'ACC_LOGGED_IN') {
            document.cookie = `lvs_token=${obj.token}; path=/; SameSite=Strict`;  // COOKIES!
            location.href = '/index.html';                  // or wherever
        } else if (obj.result === 'ACC_NOT_EXIST') {
            loginError.textContent = 'Account does not exist.';
        } else if (obj.result === 'WRONG_PASSWORD') {
            loginError.textContent = 'Wrong password.';
        } else {
            loginError.textContent = 'Unexpected server reply.';
        }
    } catch (e) {
        loginError.textContent = 'Network error. ERROR: ' + e.message;
    }
});
</script>
</body>
</html>
