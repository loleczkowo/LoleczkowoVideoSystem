<!-- TEST FOR CONNECTION, AND YES IK IK ITS BY CHAT GPT BUT IM NOT A FRONTEND DEV -->


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Loleczkowo Video System – User</title>

  <!-- ── plain styling ── -->
  <style>
    html,body{height:100%;margin:0;background:#fff;color:#000;
              font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
    body{display:flex;flex-direction:column;justify-content:center;align-items:center;}

    /* logout button */
    #logout-btn{position:fixed;top:1rem;right:1rem;padding:.35rem .8rem;font-size:.9rem;
                border:1px solid #000;background:#fff;cursor:pointer;}

    /* user card */
    #user-card{max-width:360px;text-align:center;}
    #user-card[hidden]{display:none;}

    dl{text-align:left;margin:1rem auto 0;width:80%;}
    dt{font-weight:600;}
    dd{margin:0 0 .6rem 0;}
  </style>
</head>
<body>

<!-- ── Logout ── -->
<button id="logout-btn" hidden>Logout</button>

<!-- ── user info ── -->
<section id="user-card" hidden>
  <h1 id="display-name" style="margin-bottom:.2rem;"></h1>
  <p id="nickname" style="margin-top:0;"></p>

  <dl>
    <dt>User&nbsp;ID</dt>     <dd id="user-id"></dd>
    <dt>Email</dt>           <dd id="email"></dd>
    <dt>Description</dt>     <dd id="description"></dd>
    <dt>Is&nbsp;mod</dt>      <dd id="is-mod"></dd>
  </dl>
</section>

<!-- ── logic ── -->
<script>
/* remove token */
function clearToken(){
  document.cookie='lvs_token=; Max-Age=0; path=/; SameSite=Lax';
}

/* fill UI */
function showUser(u){
  document.getElementById('display-name').textContent = u.display_name || u.nickname;
  document.getElementById('nickname').textContent     = '@'+u.nickname;
  document.getElementById('user-id').textContent      = u.id;
  document.getElementById('email').textContent        = u.email;
  document.getElementById('description').textContent  = u.description || '—';
  document.getElementById('is-mod').textContent       = u.is_mod ? 'yes' : 'no';

  document.getElementById('logout-btn').hidden=false;
  document.getElementById('user-card').hidden=false;
}

async function testConnection(){
  try{
    const rsp=await fetch('/api/test-connection',{credentials:'include'});
    const data=await rsp.json();

    if(data.result==='VALID_SESSION'){
      showUser(data.user);
    }else{
      clearToken();
      location.href='verification/login.html';
    }
  }catch(err){
    console.error('Connection error:',err);
    location.href='verification/login.html';
  }
}

document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('logout-btn').addEventListener('click',()=>{
    clearToken();
    location.href='/';
  });
  testConnection();
});
</script>
</body>
</html>
